# Рабочие Инструменты для Редакции

> Практичные функции для ежедневной работы журналистов — такие же важные как AI-перевод и автопубликация.

---

## Текущие Инструменты (уже работают)

| Инструмент | Где | Как использовать |
|------------|-----|------------------|
| AI-перевод KZ↔RU | Редактор статьи | Кнопка "Перевести" |
| AI-генерация тегов | Редактор статьи | Кнопка "Автозаполнение AI" |
| AI-анализ статьи | Редактор статьи | Кнопка "AI-редактор" |
| Проверка орфографии | Список статей | Checkbox + кнопка |
| Автопубликация | Редактор статьи | Checkbox соцсетей |
| Загрузка изображений | Редактор | Drag&Drop / кнопка |
| YouTube вставка | Редактор | Кнопка видео |

---

## Новые Инструменты (высокий приоритет)

### 1. Счётчик Символов и Слов

**Проблема:** Журналист не видит объём текста, сложно соблюдать редакционные требования.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ Содержание (казахский) *                             │
│ ─────────────────────────────────────────────────── │
│                                                      │
│ [Текст статьи...]                                    │
│                                                      │
│ ─────────────────────────────────────────────────── │
│ 📝 Слов: 342  │  Символов: 2,156  │  ⏱️ ~2 мин      │
└─────────────────────────────────────────────────────┘
```

**Реализация:**
```typescript
// apps/web/src/components/word-counter.tsx
export function WordCounter({ content }: { content: string }) {
  const text = content.replace(/<[^>]*>/g, '').trim();
  const words = text.split(/\s+/).filter(Boolean).length;
  const chars = text.length;
  const readingTime = Math.ceil(words / 200); // 200 слов/мин

  return (
    <div className="flex gap-4 text-sm text-gray-500 py-2 border-t">
      <span>📝 Слов: {words}</span>
      <span>Символов: {chars.toLocaleString()}</span>
      <span>⏱️ ~{readingTime} мин</span>
    </div>
  );
}
```

**Сложность:** 🟢 Низкая (2-3 часа)

---

### 2. Автосохранение Черновиков

**Проблема:** Журналист теряет работу при сбое браузера или случайном закрытии.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ 💾 Черновик автоматически сохранён в 14:32          │
│    [Восстановить предыдущую версию]                 │
└─────────────────────────────────────────────────────┘
```

**Функции:**
- Сохранение каждые 30 секунд в localStorage
- Восстановление при повторном открытии
- Уведомление о наличии несохранённого черновика
- Очистка после успешной публикации

**Реализация:**
```typescript
// apps/web/src/hooks/use-autosave.ts
export function useAutosave(articleId: string, content: object) {
  const AUTOSAVE_KEY = `draft_${articleId || 'new'}`;

  // Сохранение каждые 30 сек
  useEffect(() => {
    const timer = setInterval(() => {
      localStorage.setItem(AUTOSAVE_KEY, JSON.stringify({
        content,
        savedAt: new Date().toISOString()
      }));
    }, 30000);
    return () => clearInterval(timer);
  }, [content]);

  // Восстановление
  const restore = () => {
    const saved = localStorage.getItem(AUTOSAVE_KEY);
    return saved ? JSON.parse(saved) : null;
  };

  return { restore, clear: () => localStorage.removeItem(AUTOSAVE_KEY) };
}
```

**Сложность:** 🟢 Низкая (3-4 часа)

---

### 3. Предпросмотр Статьи

**Проблема:** Журналист не видит, как статья будет выглядеть на сайте до публикации.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ [Редактировать]  [👁️ Предпросмотр]  [Сохранить]    │
├─────────────────────────────────────────────────────┤
│                                                      │
│  📱 Mobile  │  💻 Desktop  │  📲 Telegram            │
│                                                      │
│ ┌───────────────────────────────────────────────┐   │
│ │                                               │   │
│ │   [Как статья выглядит на сайте]             │   │
│ │                                               │   │
│ └───────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────┘
```

**Функции:**
- Переключение Mobile/Desktop/Telegram
- Точный рендеринг как на сайте
- Проверка обложки и форматирования

**Сложность:** 🟡 Средняя (1-2 дня)

---

### 4. Очистка Текста из Word/Google Docs

**Проблема:** При копировании из Word вставляется мусорное форматирование.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ 📋 Вставлен текст из Word                           │
│                                                      │
│ [Сохранить форматирование]  [🧹 Очистить]           │
└─────────────────────────────────────────────────────┘
```

**Функции:**
- Автоопределение вставки из Word/Google Docs
- Удаление лишних тегов и стилей
- Сохранение только базового форматирования (жирный, курсив, списки)

**Реализация в TipTap:**
```typescript
// Добавить в rich-text-editor.tsx
handlePaste: (view, event) => {
  const html = event.clipboardData?.getData('text/html');
  if (html && (html.includes('mso-') || html.includes('docs-internal'))) {
    // Показать диалог очистки
    showCleanupDialog(html);
    return true;
  }
  return false;
}
```

**Сложность:** 🟡 Средняя (4-6 часов)

---

### 5. Быстрые Цитаты и Выделения

**Проблема:** Сложно оформлять цитаты, выноски, важные блоки.

**Решение — Новые блоки в редакторе:**
```
┌─────────────────────────────────────────────────────┐
│ 💬 Цитата                                           │
│ ───────────────────────────────────────────────────│
│ "Бүгін біз жаңа кезеңге қадам бастық"               │
│                          — Қасым-Жомарт Тоқаев     │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│ ⚠️ Важно                                            │
│ ───────────────────────────────────────────────────│
│ Регистрация открыта до 15 января                   │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│ 📊 Факт                                             │
│ ───────────────────────────────────────────────────│
│ В 2024 году ВВП вырос на 5.1%                      │
└─────────────────────────────────────────────────────┘
```

**Типы блоков:**
- 💬 Цитата (с автором)
- ⚠️ Важно / Внимание
- 📊 Факт / Статистика
- 💡 Интересно
- 📌 Примечание редакции

**Сложность:** 🟡 Средняя (1 день)

---

### 6. История Версий Статьи

**Проблема:** Нужно откатиться к предыдущей версии или посмотреть, что изменилось.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ 📜 История изменений                                │
├─────────────────────────────────────────────────────┤
│ Сегодня 14:30 — Айгуль (текущая)                   │
│ Сегодня 14:15 — Айгуль                             │
│ Вчера 18:00 — Нурлан                               │
│ Вчера 16:30 — Нурлан (создано)                     │
├─────────────────────────────────────────────────────┤
│ [Сравнить версии]  [Восстановить выбранную]        │
└─────────────────────────────────────────────────────┘
```

**Реализация:**
```prisma
model ArticleVersion {
  id          String   @id @default(uuid())
  articleId   String
  article     Article  @relation(fields: [articleId], references: [id])
  titleKz     String
  titleRu     String?
  contentKz   String
  contentRu   String?
  editedBy    String
  user        User     @relation(fields: [editedBy], references: [id])
  createdAt   DateTime @default(now())

  @@index([articleId])
}
```

**Сложность:** 🟡 Средняя (1-2 дня)

---

### 7. Быстрый Поиск и Замена

**Проблема:** Нужно заменить слово/фразу по всей статье.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ 🔍 Найти и заменить                     [×]         │
├─────────────────────────────────────────────────────┤
│ Найти:   [Астана________________]  3 совпадения    │
│ Заменить: [Нұр-Сұлтан____________]                  │
│                                                      │
│ [< Предыдущий] [Следующий >] [Заменить] [Все]       │
└─────────────────────────────────────────────────────┘
```

**Горячие клавиши:**
- `Ctrl+F` — Открыть поиск
- `Ctrl+H` — Найти и заменить
- `F3` — Следующее совпадение

**Сложность:** 🟢 Низкая (TipTap имеет встроенную поддержку)

---

### 8. Вставка Таблиц

**Проблема:** Нельзя вставить таблицу для данных, расписаний, сравнений.

**Решение:**
```
┌──────────┬──────────┬──────────┐
│ Область  │ 2023     │ 2024     │
├──────────┼──────────┼──────────┤
│ Астана   │ 1.2 млн  │ 1.35 млн │
│ Алматы   │ 2.0 млн  │ 2.1 млн  │
│ Шымкент  │ 1.1 млн  │ 1.15 млн │
└──────────┴──────────┴──────────┘
```

**Функции:**
- Добавление/удаление строк и столбцов
- Объединение ячеек
- Выравнивание текста
- Стили таблиц

**Реализация:** TipTap Table Extension

**Сложность:** 🟢 Низкая (расширение уже есть)

---

### 9. Быстрые Ссылки (Упоминания)

**Проблема:** Нужно часто ссылаться на другие статьи, людей, организации.

**Решение:**
```
Ввод: @астана
┌─────────────────────────────────────────────────────┐
│ 📰 Статьи:                                          │
│   • В Астане открылся новый...                     │
│   • Аким Астаны встретился...                      │
├─────────────────────────────────────────────────────┤
│ 👤 Персоны:                                         │
│   • Тоқаев Қасым-Жомарт                            │
│   • Сағынтаев Бақытжан                             │
└─────────────────────────────────────────────────────┘
```

**Функции:**
- `@` — поиск статей и персон
- `#` — поиск тегов
- Автоподстановка ссылки

**Сложность:** 🟡 Средняя (1-2 дня)

---

### 10. Дубликат Статьи

**Проблема:** Нужно создать похожую статью на основе существующей.

**Решение:**
```
┌─────────────────────────────────────────────────────┐
│ Список статей                                       │
├─────────────────────────────────────────────────────┤
│ ☐ Статья 1    [✏️] [👁️] [📋 Дублировать] [🗑️]      │
│ ☐ Статья 2    [✏️] [👁️] [📋 Дублировать] [🗑️]      │
└─────────────────────────────────────────────────────┘
```

**Функции:**
- Копирование всех полей
- Добавление "(копия)" к заголовку
- Сброс статуса в "Черновик"
- Открытие редактора копии

**Сложность:** 🟢 Низкая (2-3 часа)

---

## Приоритеты Реализации

### Немедленно (эта неделя)

| Инструмент | Время | Ценность |
|------------|-------|----------|
| Счётчик слов/символов | 2-3 часа | ⭐⭐⭐⭐⭐ |
| Автосохранение | 3-4 часа | ⭐⭐⭐⭐⭐ |
| Дубликат статьи | 2-3 часа | ⭐⭐⭐⭐ |

### Следующая неделя

| Инструмент | Время | Ценность |
|------------|-------|----------|
| Поиск и замена | 4 часа | ⭐⭐⭐⭐ |
| Очистка из Word | 4-6 часов | ⭐⭐⭐⭐ |
| Таблицы | 4 часа | ⭐⭐⭐ |

### Этот месяц

| Инструмент | Время | Ценность |
|------------|-------|----------|
| Предпросмотр | 1-2 дня | ⭐⭐⭐⭐ |
| Быстрые цитаты | 1 день | ⭐⭐⭐⭐ |
| История версий | 1-2 дня | ⭐⭐⭐⭐ |
| Быстрые ссылки | 1-2 дня | ⭐⭐⭐ |

---

## Общий План

```
Неделя 1:
├── ✅ Счётчик слов (2 часа)
├── ✅ Автосохранение (4 часа)
└── ✅ Дубликат статьи (3 часа)

Неделя 2:
├── Поиск и замена (4 часа)
├── Очистка из Word (6 часов)
└── Таблицы (4 часа)

Неделя 3-4:
├── Предпросмотр (2 дня)
├── Быстрые цитаты (1 день)
├── История версий (2 дня)
└── Быстрые ссылки (2 дня)
```

---

## API Эндпоинты

```
POST /api/articles/:id/duplicate     # Создать копию статьи
GET  /api/articles/:id/versions      # История версий
POST /api/articles/:id/versions      # Сохранить версию
GET  /api/articles/:id/versions/:vid # Получить версию
POST /api/articles/:id/restore/:vid  # Восстановить версию
GET  /api/search/articles?q=         # Поиск для упоминаний
GET  /api/search/persons?q=          # Поиск персон
```

---

## Результат

После реализации журналист получит:

| До | После |
|----|-------|
| Не видит объём текста | Счётчик слов в реальном времени |
| Теряет работу при сбое | Автосохранение каждые 30 сек |
| Мусор из Word | Автоочистка форматирования |
| Нет истории изменений | Полная история с откатом |
| Сложно делать похожие статьи | Дубликат в 1 клик |
| Нельзя вставить таблицу | Полноценные таблицы |
| Долгий поиск по тексту | Ctrl+F с заменой |

**Итог:** Smart CMS станет удобнее, чем Word + ручная публикация.
