# Техническое Задание: Система Мониторинга Актуальных Тем

## 1. Общие Сведения

| Параметр | Значение |
|----------|----------|
| **Название** | News Feed Monitor (Мониторинг новостей) |
| **Версия** | 1.0 |
| **Проект** | Smart CMS (AIMAK) |
| **Тип** | Модуль системы |

## 2. Назначение Системы

Система предназначена для автоматического мониторинга новостных источников Казахстана с целью выявления актуальных тем дня и предоставления редакции инструмента для быстрого реагирования на события.

### 2.1 Основные Функции

1. **Сбор данных** — парсинг заголовков и ссылок из новостных источников
2. **Кластеризация** — группировка новостей по темам с помощью AI
3. **Ранжирование** — определение "горячести" темы по количеству упоминаний
4. **Отображение** — панель актуальных тем для редакции
5. **Интеграция** — возможность создать статью на основе темы

### 2.2 Ограничения (юридические)

- Система НЕ копирует полные тексты статей
- Система НЕ хранит контент источников
- Система показывает только: заголовок, ссылку, время публикации
- Вся работа с контентом происходит по ссылке на оригинал

## 3. Требования

### 3.1 Функциональные Требования

#### FR-01: Парсинг источников
- Система должна парсить RSS-ленты новостных сайтов
- Система должна парсить HTML-страницы сайтов без RSS
- Частота парсинга: каждые 15 минут для приоритетных источников
- Частота парсинга: каждые 30 минут для второстепенных

#### FR-02: Обработка данных
- Извлечение: заголовок, URL, дата публикации, источник
- Дедупликация по URL
- Определение языка (казахский/русский)
- Извлечение ключевых слов из заголовка

#### FR-03: Кластеризация тем
- Группировка новостей по схожим ключевым словам
- Минимум 3 источника для создания "темы"
- AI-генерация названия темы на двух языках
- Автоматическое определение категории

#### FR-04: Панель редактора
- Отображение топ-20 актуальных тем
- Фильтрация по категориям
- Сортировка по "горячести" / времени
- Детальный просмотр темы со списком источников
- Кнопка "Создать статью"

#### FR-05: Создание статьи
- Создание черновика с заголовком темы
- Добавление ссылок на источники в примечание
- Переход в редактор статьи

### 3.2 Нефункциональные Требования

#### NFR-01: Производительность
- Парсинг одного источника: < 5 секунд
- Кластеризация: < 30 секунд для 1000 новостей
- Загрузка панели тем: < 1 секунда

#### NFR-02: Надёжность
- Система продолжает работу при недоступности отдельных источников
- Retry-логика с экспоненциальной задержкой
- Логирование всех ошибок

#### NFR-03: Масштабируемость
- Поддержка до 50 источников
- Хранение данных за последние 7 дней
- Автоочистка старых записей

## 4. Источники Данных

### 4.1 Приоритет 1 (каждые 15 мин)

| Источник | URL | Тип | Язык |
|----------|-----|-----|------|
| Tengrinews | tengrinews.kz | RSS | KZ/RU |
| Inform.kz | inform.kz | RSS | KZ/RU |
| Kazinform | kazinform.kz | RSS | KZ/RU |
| 24.kz | 24.kz | HTML | KZ/RU |
| Akorda.kz | akorda.kz | HTML | KZ/RU |

### 4.2 Приоритет 2 (каждые 30 мин)

| Источник | URL | Тип | Язык |
|----------|-----|-----|------|
| NUR.kz | nur.kz | RSS | KZ/RU |
| Zakon.kz | zakon.kz | RSS | RU |
| Liter.kz | liter.kz | HTML | KZ |
| Kapital.kz | kapital.kz | RSS | RU |
| Orda.kz | orda.kz | HTML | RU |
| Vlast.kz | vlast.kz | HTML | RU |

### 4.3 Приоритет 3 (каждый час)

| Источник | URL | Тип | Язык |
|----------|-----|-----|------|
| Government.kz | government.kz | HTML | KZ/RU |
| Parlam.kz | parlam.kz | HTML | KZ/RU |
| Stat.gov.kz | stat.gov.kz | HTML | KZ/RU |

## 5. Категории Тем

| Код | Название KZ | Название RU |
|-----|-------------|-------------|
| politics | Саясат | Политика |
| economy | Экономика | Экономика |
| society | Қоғам | Общество |
| sport | Спорт | Спорт |
| culture | Мәдениет | Культура |
| world | Әлем | Мир |
| tech | Технология | Технологии |
| incidents | Оқиғалар | Происшествия |

## 6. Пользовательские Роли

| Роль | Доступ |
|------|--------|
| ADMIN | Полный доступ + управление источниками |
| EDITOR | Просмотр тем + создание статей |
| USER | Нет доступа |

## 7. Интеграции

### 7.1 Внутренние
- **Articles Module** — создание черновиков статей
- **Categories Module** — привязка категорий
- **Auth Module** — авторизация

### 7.2 Внешние
- **OpenRouter API** — AI для кластеризации и ключевых слов

## 8. Технологический Стек

| Компонент | Технология |
|-----------|------------|
| Backend | NestJS 10 |
| База данных | PostgreSQL 15 |
| ORM | Prisma |
| Парсинг RSS | rss-parser |
| Парсинг HTML | cheerio |
| Планировщик | @nestjs/schedule |
| AI | OpenRouter API |
| Frontend | Next.js 14 / React |

## 9. Метрики Успеха

| Метрика | Целевое значение |
|---------|------------------|
| Актуальность тем | Темы появляются в течение 30 мин |
| Точность кластеризации | > 80% правильных группировок |
| Покрытие источников | > 90% успешных парсингов |
| Использование редакцией | > 50% статей создаются через систему |

## 10. Риски

| Риск | Вероятность | Митигация |
|------|-------------|-----------|
| Блокировка IP источником | Средняя | Ротация User-Agent, задержки |
| Изменение структуры сайта | Высокая | Мониторинг, быстрое обновление |
| Перегрузка AI API | Низкая | Кеширование, batch-обработка |
| Юридические претензии | Низкая | Только заголовки + ссылки |

## 11. Этапы Разработки

### Этап 1: MVP (2 недели)
- Модели данных
- Парсеры (5 источников)
- Базовая кластеризация
- Панель тем

### Этап 2: Расширение (2 недели)
- +10 источников
- AI-улучшение кластеризации
- Уведомления

### Этап 3: Оптимизация (1 неделя)
- Производительность
- Аналитика
- Документация
